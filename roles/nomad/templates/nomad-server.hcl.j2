# Nomad Server Configuration
# Auto-generated by Ansible

datacenter = "{{ datacenter }}"
region = "{{ region }}"
data_dir = "{{ nomad_data_dir }}"
log_level = "{{ nomad_log_level }}"

bind_addr = "0.0.0.0"

advertise {
  http = "{{ ansible_host }}"
  rpc = "{{ ansible_host }}"
  serf = "{{ ansible_host }}"
}

server {
  enabled = true
  bootstrap_expect = {{ nomad_bootstrap_expect }}

  # Server join configuration for multi-master setup
  server_join {
    retry_join = {{ nomad_retry_join | to_json }}
    retry_max = 5
    retry_interval = "15s"
  }
}

# Consul Integration
consul {
  address = "127.0.0.1:8500"
  server_service_name = "nomad"
  client_service_name = "nomad-client"
  auto_advertise = true
  server_auto_join = true
  client_auto_join = true
}

# UI Configuration
ui {
  enabled = {{ nomad_ui_enabled | lower }}
}

# Telemetry
telemetry {
  prometheus_metrics = true
  disable_hostname = true
  publish_allocation_metrics = true
  publish_node_metrics = true
}
